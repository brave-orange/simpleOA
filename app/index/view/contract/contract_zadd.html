<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="__STATIC__/layui/css/layui.css"  media="all">
    <script type="text/javascript" src="__STATIC__/js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="__STATIC__/layer/layer/layer.js"></script>
    <script src="__STATIC__/layui/layui.js"></script>
    <style>
        table input[type='text']{
            width:100%;
            height:100%;}
        .layui-table td{
            padding:0;
        }
        .channel_mon{
            display:none;
        }
    </style>
</head>
<body>
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 5px;">
    <legend style="color:#1E9FFF">添加销售合同基本信息</legend>
</fieldset>
<form class="layui-form" action="">
    <div class="layui-form-item">
        <label class="layui-form-label" style="width:88px">销售客户名称:</label>
        <div class="layui-input-inline">
            <input type="text" name="xname" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
        </div>

    </div>
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
    </fieldset>
    <div class="layui-form-item">
        <label class="layui-form-label" style="width:88px">销售合同金额:</label>
        <div class="layui-input-inline">
            <input type="text" name="xmoney" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
        </div>
        <label class="layui-form-label" style="width:88px">选择逾期日期:</label>
        <div class="layui-inline"> <!-- 注意：这一层元素并不是必须的 -->
            <input type="text" class="layui-input" id="test1">
        </div>
    </div>
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
        <legend style="color:#1E9FFF">添加采购合同基本信息</legend>
    </fieldset>
    <div class="layui-form-item">
        <label class="layui-form-label">采购定金:</label>
        <div class="layui-input-inline">
            <input type="text" name="emoney" placeholder="请输入" autocomplete="off" class="layui-input">
        </div>
        <label class="layui-form-label">采购金额:</label>
        <div class="layui-input-inline">
            <input type="text" name="cmoney"  lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
        </div>
    </div>
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
    </fieldset>
    <div class="layui-form-item">
        <label class="layui-form-label" style="width:88px">采购客户名称:</label>
        <div class="layui-input-inline">
            <input type="text" name="cname" lay-verify="required" placeholder="请输入采购客户" autocomplete="off" class="layui-input">
        </div>
        <label class="layui-form-label" style="width:88px">选择付款日期</label>
        <div class="layui-inline"> <!-- 注意：这一层元素并不是必须的 -->
        <input type="text" class="layui-input" id="test2">
        </div>
    </div>
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
        <legend style="color:#1E9FFF">合同内容</legend>
    </fieldset>
    <div class="layui-form-item">
        <label class="layui-form-label">合同备注</label>
        <div class="layui-input-block">
            <input type="text" name="remarks" lay-verify="title" autocomplete="off" placeholder="请输入内容(可选填)" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">创建日期</label>
        <div class="layui-inline"> <!-- 注意：这一层元素并不是必须的 -->
            <input type="text" class="layui-input" id="test3">
        </div>
        <button type="button" class="layui-btn layui-btn-normal" id="test4"><i class="layui-icon">&#xe67c;</i>上传附件照片</button>
    </div>
    <div class="layui-upload-list">
        <table class="layui-table">
            <thead>
            <tr><th>文件名</th>
                <th>大小</th>
                <th>状态</th>
                <th>操作</th>
            </tr></thead>
            <tbody id="demoList"></tbody>
        </table>
    </div>
    <div style="margin-top: 20px;"></div>
    <div class="layui-form-item">
        <div class="layui-input-block">
            <button id="butt" class="layui-btn" lay-submit lay-filter="formDemo" style="margin-left:80px">立即提交</button>
            <button type="reset" class="layui-btn layui-btn-primary" style="margin-left:140px">重置</button>
        </div>
        <input type="hidden" name="xdateofcollection">
        <input type="hidden" name="cdateofcollection">
        <input type="hidden" name="createdate">
        <input type="hidden" name="contract_file">
    </div>
</form>
</body>
<script>
    layui.use('laydate', function(){
        var laydate = layui.laydate;
        //设置逾期日期
        laydate.render({
            elem: '#test1' //指定元素
            ,done:function (value) {
                $('input[name="xdateofcollection"]').val(value);
            }
        });
        //设置付款日期
        laydate.render({
            elem: '#test2' //指定元素
            ,done:function (value) {
                $('input[name="cdateofcollection"]').val(value);
            }
        });
        //创建日期
        laydate.render({
            elem: '#test3' //指定元素
            ,done:function (value) {
                $('input[name="createdate"]').val(value);
            }
        });

    });
    layui.use('upload',function () {
        var upload = layui.upload;
        var demoListView = $('#demoList');
        upload.render({
            elem: '#test4'
            ,url: '{:url("index/contract/images")}'
            ,auto: false //选择文件后不自动上传
            ,bindAction: '#butt' //指向一个按钮触发上传
            ,field:'zadd'
            ,multiple:true
            ,number:'5'
            ,choose: function(obj){
                //将每次选择的文件追加到文件队列
                var files = obj.pushFile();

                //预读本地文件，如果是多文件，则会遍历。(不支持ie8/9)
                obj.preview(function(index, file, result){
                    var tr = $(['<tr id="upload-'+ index +'">'
                        ,'<td>'+ file.name +'</td>'
                        ,'<td>'+ (file.size/1014).toFixed(1) +'kb</td>'
                        ,'<td>等待上传</td>'
                        ,'<td>'
                        ,'<button class="layui-btn layui-btn-xs demo-reload layui-hide">重传</button>'
                        ,'<button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除</button>'
                        ,'</td>'
                        ,'</tr>'].join(''));
                    //单个重传
                    tr.find('.demo-reload').on('click', function(){
                        obj.upload(index, file);
                    });

                    //删除
                    tr.find('.demo-delete').on('click', function(){
                        delete files[index]; //删除对应的文件
                        tr.remove();
                        uploadListIns.config.elem.next()[0].value = ''; //清空 input file 值，以免删除后出现同名文件不可选
                    });

                    demoListView.append(tr);
//                    console.log(index); //得到文件索引
//                    console.log(file); //得到文件对象
//                    console.log(result); //得到文件base64编码，比如图片

                    //obj.resetFile(index, file, '123.jpg'); //重命名文件名，layui 2.3.0 开始新增

                    //这里还可以做一些 append 文件列表 DOM 的操作

                    //obj.upload(index, file); //对上传失败的单个文件重新上传，一般在某个事件中使用
                    //delete files[index]; //删除列表中对应的文件，一般在某个事件中使用
                });
            }
            ,done:function (res,index,upload) {
                if(res.status == 'success'){
                    $('input[name="contract_file"]').val(res.msg);
                }else{
                    $('input[name="contract_file"]').val();
                }

            }
        });
    })

        layui.use('form', function(){
            var form = layui.form;
            form.on('submit(formDemo)', function(data){
                var dataobj=data.field;
                $.ajax({
                    url:"{:url('index/contract/zadd_data')}",
                    type:"post",
                    data:{formdata:JSON.stringify(dataobj)},
                    success:function (res) {
                        res=JSON.parse(res);
                        if(res.status=='success'){
                            layer.msg(res.msg);
                        }else{
                            layer.msg(res.msg);
                        }
                    },
                    error:function () {
                        alert('网络错误!!!');
                    }
                })
                return false;
            });
        });



</script>
</html>